# Реферальная система (API)  

Простая система для регистрации пользователей по номеру телефона и работы с реферальными кодами.  

## API Endpoints  

### 1. Авторизация по номеру телефона  
**Запрос:**  
`POST /api/auth/`  
**Тело запроса (JSON):**  
```json
{
    "phone_number": "+79991234567"
}
```
**Ответ:**  
```json
{
    "message": "Code sent"
}
```
*(Симуляция отправки SMS с кодом, задержка 1-2 сек.)*  

---  

### 2. Подтверждение кода  
**Запрос:**  
`POST /api/verify/`  
**Тело запроса (JSON):**  
```json
{
    "code": "1234"  // 4 цифры (любые, в текущей реализации)
}
```
**Ответ (успех):**  
```json
{
    "message": "Authenticated",
    "invite_code": "A1B2C3"  // 6-значный код пользователя
}
```
**Ошибки:**  
- `400` – неверный формат кода.  
- `404` – номер телефона не найден в сессии.  

---  

### 3. Профиль пользователя  
#### Получить профиль  
**Запрос:**  
`GET /api/profile/`  
**Ответ:**  
```json
{
    "phone_number": "+79991234567",
    "invite_code": "A1B2C3",
    "activated_invite_code": "XYZ789",  // если есть
    "referrals": ["+79997776655"]       // список рефералов
}
```

#### Активировать инвайт-код  
**Запрос:**  
`POST /api/profile/`  
**Тело запроса (JSON):**  
```json
{
    "invite_code": "XYZ789"  // чужой 6-значный код
}
```
**Ответ (успех):**  
```json
{
    "status": "Code successfully activated",
    "activated_invite_code": "XYZ789"
}
```
**Ошибки:**  
- `400` – нельзя активировать свой код или уже есть активный.  
- `404` – код не существует.  

---  

## Как запустить  
1.  Убедитесь, что Docker и Docker Compose установлены.
2.  Создайте файл `.env` в корневой директории проекта (рядом с `docker-compose.yml`) со следующим содержимым (замените `ваш-секретный-ключ` на реальный ключ): 
   ```bash
   # Настройки PostgreSQL 
    POSTGRES_DB=<Имя базы данных>
    POSTGRES_USER=<Имя пользователя>
    POSTGRES_PASSWORD=<Пароль пользователя> 

    # Django настройки
    SECRET_KEY=<ваш-секретный-ключ>
    DEBUG=True
    ALLOWED_HOSTS=*

    # DB настройки в Django
    DB_ENGINE=django.db.backends.postgresql
    DB_NAME=<Имя базы данных>
    DB_USER=<Имя пользователя>
    DB_PASSWORD=<Пароль пользователя>
    DB_HOST=db
    DB_PORT=<Порт базы данных>
   ```
*(Убедитесь, что значения `POSTGRES_*` совпадают с `DB_*` для корректной работы).*

3.  Убедитесь, что файлы `Dockerfile` и `docker-compose.yml` находятся в корневой директории проекта и содержат исправленные настройки томов и сервисов, как показано выше.
4.  Запустите проект с помощью Docker Compose:
    ```bash
    docker-compose up -d
    ```
    Эта команда соберет образы, создаст и запустит контейнеры в фоновом режиме. Миграции будут применены автоматически.
5.  Приложение будет доступно по адресу `http://localhost:8000`.
6.  Для остановки и удаления контейнеров используйте:
    ```bash
    docker-compose down
    ```
    Для остановки и удаления контейнеров **вместе с данными БД** (осторожно!):
    ```bash
    docker-compose down -v
    ```